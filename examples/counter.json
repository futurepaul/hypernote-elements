{
  "version": "1.1.0",
  "type": "hypernote",
  "title": "ContextVM Counter",
  "description": "Interactive counter demonstrating triggers and state management",
  "name": "contextvm-counter",
  "queries": {
    "$count": {
      "kinds": [
        30078
      ],
      "authors": [
        "user.pubkey"
      ],
      "limit": 1,
      "#d": [
        "counter"
      ],
      "pipe": [
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "default",
          "value": "0"
        }
      ]
    },
    "$update_increment": {
      "kinds": [
        25910
      ],
      "authors": [
        "19f5b5cd2fce663a3b4916b42c378c0280cce2bffd0af384380e91356fcff1d6"
      ],
      "#e": [
        "@increment"
      ],
      "pipe": [
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "json"
        },
        {
          "op": "get",
          "field": "result"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "text"
        }
      ],
      "triggers": "@save_increment"
    },
    "$update_decrement": {
      "kinds": [
        25910
      ],
      "authors": [
        "19f5b5cd2fce663a3b4916b42c378c0280cce2bffd0af384380e91356fcff1d6"
      ],
      "#e": [
        "@decrement"
      ],
      "pipe": [
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "json"
        },
        {
          "op": "get",
          "field": "result"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "text"
        }
      ],
      "triggers": "@save_decrement"
    }
  },
  "events": {
    "@increment": {
      "kind": 25910,
      "json": {
        "jsonrpc": "2.0",
        "id": "{time.now}",
        "method": "tools/call",
        "params": {
          "name": "addone",
          "arguments": {
            "a": "{$count or 0}"
          }
        }
      },
      "tags": [
        [
          "p",
          "19f5b5cd2fce663a3b4916b42c378c0280cce2bffd0af384380e91356fcff1d6"
        ]
      ]
    },
    "@decrement": {
      "kind": 25910,
      "json": {
        "jsonrpc": "2.0",
        "id": "{time.now}",
        "method": "tools/call",
        "params": {
          "name": "minusone",
          "arguments": {
            "a": "{$count or 0}"
          }
        }
      },
      "tags": [
        [
          "p",
          "19f5b5cd2fce663a3b4916b42c378c0280cce2bffd0af384380e91356fcff1d6"
        ]
      ]
    },
    "@save_increment": {
      "kind": 30078,
      "content": "{$update_increment}",
      "tags": [
        [
          "d",
          "counter"
        ]
      ]
    },
    "@save_decrement": {
      "kind": 30078,
      "content": "{$update_decrement}",
      "tags": [
        [
          "d",
          "counter"
        ]
      ]
    },
    "@initialize": {
      "kind": 30078,
      "content": "0",
      "tags": [
        [
          "d",
          "counter"
        ]
      ]
    }
  },
  "elements": [
    {
      "type": "h1",
      "content": [
        "Counter Example"
      ]
    },
    {
      "type": "div",
      "style": {
        "textAlign": "center"
      },
      "elements": [
        {
          "type": "h2",
          "content": [
            "Current count: {$count or 0}"
          ]
        }
      ]
    },
    {
      "type": "form",
      "event": "@increment",
      "elements": [
        {
          "type": "button",
          "style": {
            "paddingTop": "0.75rem",
            "paddingRight": "1.5rem",
            "paddingBottom": "0.75rem",
            "paddingLeft": "1.5rem",
            "color": "rgb(255,255,255)",
            "backgroundColor": "rgb(22,163,74)",
            "fontSize": "1.25rem",
            "fontWeight": 700,
            "lineHeight": "1.75rem",
            "borderRadius": "0.5rem"
          },
          "elements": [
            {
              "type": "p",
              "content": [
                "+1"
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "form",
      "event": "@decrement",
      "elements": [
        {
          "type": "button",
          "style": {
            "paddingTop": "0.75rem",
            "paddingRight": "1.5rem",
            "paddingBottom": "0.75rem",
            "paddingLeft": "1.5rem",
            "color": "rgb(255,255,255)",
            "backgroundColor": "rgb(220,38,38)",
            "fontSize": "1.25rem",
            "fontWeight": 700,
            "lineHeight": "1.75rem",
            "borderRadius": "0.5rem"
          },
          "elements": [
            {
              "type": "p",
              "content": [
                "-1"
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "form",
      "event": "@initialize",
      "elements": [
        {
          "type": "button",
          "style": {
            "paddingTop": "0.5rem",
            "paddingRight": "1rem",
            "paddingBottom": "0.5rem",
            "paddingLeft": "1rem",
            "color": "rgb(255,255,255)",
            "backgroundColor": "rgb(37,99,235)",
            "borderRadius": "0.25rem"
          },
          "elements": [
            {
              "type": "p",
              "content": [
                "Initialize Counter"
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "json",
      "content": [],
      "attributes": {
        "variable": "$count"
      }
    }
  ]
}
