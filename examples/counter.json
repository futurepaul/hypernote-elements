{
  "version": "1.1.0",
  "type": "hypernote",
  "title": "ContextVM Counter",
  "description": "Interactive counter demonstrating reactive events and state management",
  "name": "contextvm-counter",
  "queries": {
    "$count": {
      "kinds": [
        30078
      ],
      "authors": [
        "user.pubkey"
      ],
      "limit": 1,
      "#d": [
        "counter"
      ],
      "pipe": [
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "default",
          "value": "0"
        }
      ]
    }
  },
  "events": {
    "@increment": {
      "kind": 25910,
      "content": "{\n  \"jsonrpc\": \"2.0\",\n  \"id\": \"{time.now}\",\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"addone\",\n    \"arguments\": {\n      \"a\": \"{$count}\"\n    }\n  }\n}\n",
      "tags": [
        [
          "p",
          "1cf0bdaf1a7a719be79fb16e32eea0fccd029e3b49f02e960e61f4e079ab96dd"
        ]
      ]
    },
    "@decrement": {
      "kind": 25910,
      "content": "{\n  \"jsonrpc\": \"2.0\",\n  \"id\": \"{time.now}\",\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"minusone\",\n    \"arguments\": {\n      \"a\": \"{$count}\"\n    }\n  }\n}\n",
      "tags": [
        [
          "p",
          "1cf0bdaf1a7a719be79fb16e32eea0fccd029e3b49f02e960e61f4e079ab96dd"
        ]
      ]
    },
    "@on_increment": {
      "match": {
        "kinds": [
          25910
        ],
        "authors": [
          "1cf0bdaf1a7a719be79fb16e32eea0fccd029e3b49f02e960e61f4e079ab96dd"
        ],
        "#e": "{@increment.id}"
      },
      "pipe": [
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "json"
        },
        {
          "op": "get",
          "field": "result"
        }
      ],
      "then": {
        "kind": 30078,
        "content": "{result}",
        "tags": [
          [
            "d",
            "counter"
          ]
        ]
      }
    },
    "@on_decrement": {
      "match": {
        "kinds": [
          25910
        ],
        "authors": [
          "1cf0bdaf1a7a719be79fb16e32eea0fccd029e3b49f02e960e61f4e079ab96dd"
        ],
        "#e": "{@decrement.id}"
      },
      "pipe": [
        {
          "op": "first"
        },
        {
          "op": "get",
          "field": "content"
        },
        {
          "op": "json"
        },
        {
          "op": "get",
          "field": "result"
        }
      ],
      "then": {
        "kind": 30078,
        "content": "{result}",
        "tags": [
          [
            "d",
            "counter"
          ]
        ]
      }
    },
    "@initialize": {
      "kind": 30078,
      "content": "0",
      "tags": [
        [
          "d",
          "counter"
        ]
      ]
    }
  },
  "elements": [
    {
      "type": "h1",
      "content": [
        "Counter Example"
      ]
    },
    {
      "type": "div",
      "style": {
        "textAlign": "center"
      },
      "elements": [
        {
          "type": "h2",
          "content": [
            "{$count or 0}"
          ]
        }
      ]
    },
    {
      "type": "form",
      "event": "@increment",
      "elements": [
        {
          "type": "button",
          "style": {
            "paddingTop": "0.75rem",
            "paddingRight": "1.5rem",
            "paddingBottom": "0.75rem",
            "paddingLeft": "1.5rem",
            "color": "rgb(255,255,255)",
            "backgroundColor": "rgb(22,163,74)",
            "fontSize": "1.25rem",
            "fontWeight": 700,
            "lineHeight": "1.75rem",
            "borderRadius": "0.5rem"
          },
          "elements": [
            {
              "type": "p",
              "content": [
                "+1"
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "form",
      "event": "@decrement",
      "elements": [
        {
          "type": "button",
          "style": {
            "paddingTop": "0.75rem",
            "paddingRight": "1.5rem",
            "paddingBottom": "0.75rem",
            "paddingLeft": "1.5rem",
            "color": "rgb(255,255,255)",
            "backgroundColor": "rgb(220,38,38)",
            "fontSize": "1.25rem",
            "fontWeight": 700,
            "lineHeight": "1.75rem",
            "borderRadius": "0.5rem"
          },
          "elements": [
            {
              "type": "p",
              "content": [
                "-1"
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "form",
      "event": "@initialize",
      "elements": [
        {
          "type": "button",
          "style": {
            "paddingTop": "0.5rem",
            "paddingRight": "1rem",
            "paddingBottom": "0.5rem",
            "paddingLeft": "1rem",
            "color": "rgb(255,255,255)",
            "backgroundColor": "rgb(37,99,235)",
            "borderRadius": "0.25rem"
          },
          "elements": [
            {
              "type": "p",
              "content": [
                "Initialize Counter"
              ]
            }
          ]
        }
      ]
    },
    {
      "type": "json",
      "content": [],
      "attributes": {
        "variable": "$count"
      }
    }
  ]
}
